<!DOCTYPE html>
<html lang="Es-es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Villa Hermosa - Comprar</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v=1"></script>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/skeleton.css">
    <link rel="stylesheet" href="css/custom.css">
</head>

<body>
    <header id="header" class="header">
        <div class="container">
            <form method="post">


                <div class="row">
                    <div class="four columns">
                        <img src="img/DIANA_LOGO2.png" id="logo" width="130px" height="45px">
                    </div>
                    <div class="two columns u-pull-right">
                        <ul>
                            <li class="submenu">
                                <img src="img/cart.png" id="img-carrito">
                                <div id="carrito">

                                    <table id="lista-carrito" class="u-full-width">
                                        <thead>
                                            <tr>
                                                <th>id</th>
                                                <th>Imagen</th>
                                                <th>Nombre</th>
                                                <th>Precio</th>
                                                <th>Cantidad</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                    <a href="#" id="pagar-carrito" class="button u-full-width">Agregar Pedido</a>
                                    <a href="#" id="vaciar-carrito" class="button u-full-width">Vaciar Carrito</a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </form>
        </div>
    </header>


    <div id="hero">
        <div class="container">
            <div class="row">
                <div class="six columns">
                    <div class="contenido-hero">
                        <h2>Nuestros platillos del día</h2>
                        <p>Disfrute de esta deliciosa experiencia</p>

                    </div>
                </div>
            </div>
        </div>
    </div>



    <div id="lista-cursos" class="container">
        <h1 id="encabezado" class="encabezado">Carta de hoy</h1>
        <div class="row">
            <div class="four columns" th:each=" plato : ${platos}">
                <div class="card">
                    <img th:src="@{'uploads/' + ${plato.foto}}" width="50px" height="200px"
                        class="imagen-curso u-full-width">
                    <div class="info-card">
                        <h4>[[${plato.nombre}]]</h4>
                        <p>[[${plato.descripcion}]]</p>
                        <img src="img/estrellas.png">
                        <p class="precio">Precio: <span class="u-pull-right ">[[${plato.precio}]]</span></p>
                        <a href="#" class="u-full-width button-primary button input agregar-carrito"
                            th:attr="data-id=${plato.Id_plato}">Agregar
                            Al Carrito</a>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <footer id="footer" class="footer">
        <div class="container">
            <div class="row">
                <div class="four columns">
                    <nav id="principal" class="menu">
                        <a class="enlace" href="#">Anímate a visitarnos</a>
                        <a class="enlace" href="#">Soporte</a>
                        <a class="enlace" href="#">Opiniones</a>
                    </nav>
                </div>
                <div class="four columns">
                    <nav id="secundaria" class="menu">
                        <a class="enlace" href="#">¿Quienes Somos?</a>
                        <a class="enlace" href="#">Empleo</a>
                        <a class="enlace" href="#">Blog</a>
                    </nav>
                </div>
            </div>
        </div>
    </footer>
    <script>
        document.getElementById('pagar-carrito').addEventListener('click', async () => {
            const carrito = []; // Obtén los datos del carrito desde tu tabla
            document.querySelectorAll('#lista-carrito tbody tr').forEach(row => {
                carrito.push({
                    id_plato:Number(row.cells[0].innerText),
                    nombre: row.cells[2].innerText,
                    precio: row.cells[3].innerText
                });
                console.log(carrito.map(item =>item.id_plato));
            });

            const datosPedido = {
                correo: "empleado20@example.com", // Cambiar por el correo del usuario autenticado
                id_platos: carrito.map(item => item.id_plato),
                estado: "ESPERA"
            };

            const response = await fetch('/pedido/guardar', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(datosPedido)
            });

            const result = await response.text();
            alert(result);
        });
    </script>
    <script src="js/carrito.js"></script>

</body>

</html>